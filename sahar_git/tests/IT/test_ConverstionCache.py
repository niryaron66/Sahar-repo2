import unittest
from unittest.mock import MagicMock, patch  # Import patch here
from datetime import datetime
from objects.conversation_cache import ConversationCache
from lp_api_manager.lp_utils import LpUtils


class MockConfigUtilWithDifferentValues:
    def get_config_attribute(self, attribute_name):
        if attribute_name == "deleteThreadCacheInterval":
            return 2  # Simulate returning the deleteThreadCacheInterval attribute value
        elif attribute_name == "maxCacheAge":
            return 8  # Simulate returning the maxCacheAge attribute value
        else:
            return None  # Return None for other attribute names


class test_ConversationCache(unittest.TestCase):
    conversation_data = {
        "_metadata": {
            "count": 1,
            "self": {
                "rel": "self",
                "href": "http://va.msghist.liveperson.net/messaging_history/api/account/40920689/conversations/conversation/search?limit=50&offset=0&v=1&source=sahar_AI_closeConv",
            },
            "shardsStatusResult": {"partialResult": False},
        },
        "conversationHistoryRecords": [
            {
                "info": {
                    "startTime": "2024-04-29 16:10:18.818+0000",
                    "startTimeL": 1714407018818,
                    "endTime": "2024-04-29 16:21:52.261+0000",
                    "endTimeL": 1714407712261,
                    "conversationEndTime": "2024-04-29 16:21:52.261+0000",
                    "conversationEndTimeL": 1714407712261,
                    "fullDialogEndTime": "2024-04-29 16:21:52.261+0000",
                    "fullDialogEndTimeL": 1714407712261,
                    "duration": 693443,
                    "conversationId": "47b21186-4501-4363-8752-27bc8bd212b7",
                    "brandId": "40920689",
                    "latestAgentId": "3998511138",
                    "latestAgentNickname": 'מתנדבת סה"ר',
                    "latestAgentFullName": "טל הלן פרנץ",
                    "latestAgentLoginName": "talfrantz123",
                    "agentDeleted": False,
                    "latestSkillId": 3748060538,
                    "latestSkillName": "Web-Messaging-Hebrew",
                    "source": "SHARK",
                    "closeReason": "CONSUMER",
                    "closeReasonDescription": "MANUAL_CLOSE",
                    "status": "CLOSE",
                    "fullDialogStatus": "CLOSE",
                    "firstConversation": False,
                    "device": "DESKTOP",
                    "browser": "CHROME",
                    "browserVersion": "123.0.0.0",
                    "operatingSystem": "WINDOWS",
                    "operatingSystemVersion": "10.0",
                    "latestAgentGroupId": -1,
                    "latestAgentGroupName": "Main Group",
                    "latestQueueState": "ACTIVE",
                    "isPartial": False,
                    "visitorId": "A4NTBiZjNmNmNkZDQxZTgz",
                    "sessionId": "19IjNQcVQVeQrIZx_ExdTw",
                    "interactionContextId": "3",
                    "timeZone": 'sun.util.calendar.ZoneInfo[id="Asia/Jerusalem",offset=7200000,dstSavings=3600000,useDaylight=true,transitions=149,lastRule=java.util.SimpleTimeZone[id=Asia/Jerusalem,offset=7200000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=23,startDayOfWeek=6,startTime=7200000,startTimeMode=0,endMode=2,endMonth=9,endDay=-1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]]',
                    "features": [
                        "PHOTO_SHARING",
                        "CO_BROWSE",
                        "QUICK_REPLIES",
                        "MARKDOWN_HYPERLINKS",
                        "AUTO_MESSAGES",
                        "MULTI_DIALOG",
                        "FILE_SHARING",
                        "RICH_CONTENT",
                    ],
                    "language": "he-IL",
                    "integration": "WEB_SDK",
                    "integrationVersion": "3.8.0",
                    "appId": "webAsync",
                    "ipAddress": "77.137.65.168",
                    "pendingAgentSurvey": True,
                    "latestHandlerAccountId": "40920689",
                    "latestHandlerSkillId": 3748060538,
                },
                "messageRecords": [
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "היי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:0",
                        "audience": "ALL",
                        "seq": 0,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:19.187+0000",
                        "timeL": 1714407019187,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "תודה שפנית לסה\"ר. נשמח להקשיב לכל מה שתבחר/י לשתף אותנו היום.\n\nלקריאת תקנון הצ'אט:\nhttps://sahar.org.il/sahars-chat-rules/"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:2",
                        "audience": "ALL",
                        "seq": 2,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:21.727+0000",
                        "timeL": 1714407021727,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"קראתי את התקנון ואני מסכימ\\\\ה","tooltip":"קראתי את התקנון ואני מסכימ\\\\ה"},{"type":"button","title":"מסכימ\\\\ה","tooltip":"מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"מסכימ\\\\ה"}]}},{"type":"button","title":"לא מסכימ\\\\ה","tooltip":"לא מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"לא מסכימ\\\\ה"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:4",
                        "audience": "ALL",
                        "seq": 4,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:23.741+0000",
                        "timeL": 1714407023741,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מסכימ\\ה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:8",
                        "audience": "ALL",
                        "seq": 8,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:25.199+0000",
                        "timeL": 1714407025199,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אנא רשמו שם או כינוי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:10",
                        "audience": "ALL",
                        "seq": 10,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:27.403+0000",
                        "timeL": 1714407027403,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"f7f124ad-8457-410c-b64c-9ec365627bf2","botInteractionId":"0e9f61dd1e14d6d43d93d3c689d9444fb5a3bdf5","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מאיה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:12",
                        "audience": "ALL",
                        "seq": 12,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:30.773+0000",
                        "timeL": 1714407030773,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:","tooltip":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:"},{"type":"button","title":"10-13","tooltip":"10-13","click":{"actions":[{"type":"publishText","text":"10-13"}]}},{"type":"button","title":"14-17","tooltip":"14-17","click":{"actions":[{"type":"publishText","text":"14-17"}]}},{"type":"button","title":"18-20","tooltip":"18-20","click":{"actions":[{"type":"publishText","text":"18-20"}]}},{"type":"button","title":"21-30","tooltip":"21-30","click":{"actions":[{"type":"publishText","text":"21-30"}]}},{"type":"button","title":"31-40","tooltip":"31-40","click":{"actions":[{"type":"publishText","text":"31-40"}]}},{"type":"button","title":"41-50","tooltip":"41-50","click":{"actions":[{"type":"publishText","text":"41-50"}]}},{"type":"button","title":"51-64","tooltip":"51-64","click":{"actions":[{"type":"publishText","text":"51-64"}]}},{"type":"button","title":"65+","tooltip":"65+","click":{"actions":[{"type":"publishText","text":"65+"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:14",
                        "audience": "ALL",
                        "seq": 14,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:33.029+0000",
                        "timeL": 1714407033029,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"cc46061d-f8ee-4ef0-a3bb-5f4d830a0f23","botInteractionId":"9979f9f953911d7a19f2a5ed1c751d7267a395a9","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "31-40"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:18",
                        "audience": "ALL",
                        "seq": 18,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:34.825+0000",
                        "timeL": 1714407034825,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": 'הנך מועבר\\ת לשוחח עם סה"ר'}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:20",
                        "audience": "ALL",
                        "seq": 20,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:35.215+0000",
                        "timeL": 1714407035215,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"ec90f86d-504e-49e5-9d14-86193a6710ef","botInteractionId":"2c88d0bb-c687-47c9-9bb5-ca8f79dd97b7","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Exact_Value","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "שלום כאן איתך לשיחה עד 40 דקות מקשיבה למה שתרצי לשתף..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:23",
                        "audience": "ALL",
                        "seq": 23,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:23.585+0000",
                        "timeL": 1714407083585,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "היי.. יש אפשרות לדבר עם מתנדב?"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:25",
                        "audience": "ALL",
                        "seq": 25,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:51.578+0000",
                        "timeL": 1714407111578,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "היי , אין לנו כרגע מתנדב את יכולה לנסות לעלות מאוחר יותר .."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:29",
                        "audience": "ALL",
                        "seq": 29,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:13:24.582+0000",
                        "timeL": 1714407204582,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אוקי. אני מבקשת לדבר עם מתנדב כי אני מכירה אחת מכן וחוששת שהיא זו שתענה לי."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:31",
                        "audience": "ALL",
                        "seq": 31,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:16.753+0000",
                        "timeL": 1714407256753,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "אבל כרגע המצב לא טוב ואני קצת חוששת מעצמי"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:35",
                        "audience": "ALL",
                        "seq": 35,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:56.608+0000",
                        "timeL": 1714407296608,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אני מבינה יקרה ... תרצי לחזור למשמרת הבאה ב21 או לשתף אותי במה שאת מרגישה ..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:38",
                        "audience": "ALL",
                        "seq": 38,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:15:25.096+0000",
                        "timeL": 1714407325096,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אני לא מצליחה לחשוב"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:40",
                        "audience": "ALL",
                        "seq": 40,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:18:14.266+0000",
                        "timeL": 1714407494266,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "שומעת שאת מרגישה מבולבלת ..."}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:44",
                        "audience": "ALL",
                        "seq": 44,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:20:47.088+0000",
                        "timeL": 1714407647088,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "לא משנה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:46",
                        "audience": "ALL",
                        "seq": 46,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:06.761+0000",
                        "timeL": 1714407666761,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "תודה לך"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:48",
                        "audience": "ALL",
                        "seq": 48,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:09.244+0000",
                        "timeL": 1714407669244,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "יקרה מצטערת שאין מענה מתאים כרגע מוזמנת לחזור ב21 ולבקש מתנדב ..❤️"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:53",
                        "audience": "ALL",
                        "seq": 53,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:41.580+0000",
                        "timeL": 1714407701580,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אוקי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:55",
                        "audience": "ALL",
                        "seq": 55,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:49.209+0000",
                        "timeL": 1714407709209,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                ],
            },
            {
                "info": {
                    "startTime": "2024-04-29 16:10:18.818+0000",
                    "startTimeL": 1714407018818,
                    "endTime": "2024-04-29 16:21:52.261+0000",
                    "endTimeL": 1714407712261,
                    "conversationEndTime": "2024-04-29 16:21:52.261+0000",
                    "conversationEndTimeL": 1714407712261,
                    "fullDialogEndTime": "2024-04-29 16:21:52.261+0000",
                    "fullDialogEndTimeL": 1714407712261,
                    "duration": 693443,
                    "conversationId": "47b21186-4501-4363-8752-123124ffs",
                    "brandId": "40920689",
                    "latestAgentId": "3998511138",
                    "latestAgentNickname": 'מתנדבת סה"ר',
                    "latestAgentFullName": "טל הלן פרנץ",
                    "latestAgentLoginName": "talfrantz123",
                    "agentDeleted": False,
                    "latestSkillId": 3748060538,
                    "latestSkillName": "Web-Messaging-Hebrew",
                    "source": "SHARK",
                    "closeReason": "CONSUMER",
                    "closeReasonDescription": "MANUAL_CLOSE",
                    "status": "CLOSE",
                    "fullDialogStatus": "CLOSE",
                    "firstConversation": False,
                    "device": "DESKTOP",
                    "browser": "CHROME",
                    "browserVersion": "123.0.0.0",
                    "operatingSystem": "WINDOWS",
                    "operatingSystemVersion": "10.0",
                    "latestAgentGroupId": -1,
                    "latestAgentGroupName": "Main Group",
                    "latestQueueState": "ACTIVE",
                    "isPartial": False,
                    "visitorId": "A4NTBiZjNmNmNkZDQxZTgz",
                    "sessionId": "19IjNQcVQVeQrIZx_ExdTw",
                    "interactionContextId": "3",
                    "timeZone": 'sun.util.calendar.ZoneInfo[id="Asia/Jerusalem",offset=7200000,dstSavings=3600000,useDaylight=true,transitions=149,lastRule=java.util.SimpleTimeZone[id=Asia/Jerusalem,offset=7200000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=23,startDayOfWeek=6,startTime=7200000,startTimeMode=0,endMode=2,endMonth=9,endDay=-1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]]',
                    "features": [
                        "PHOTO_SHARING",
                        "CO_BROWSE",
                        "QUICK_REPLIES",
                        "MARKDOWN_HYPERLINKS",
                        "AUTO_MESSAGES",
                        "MULTI_DIALOG",
                        "FILE_SHARING",
                        "RICH_CONTENT",
                    ],
                    "language": "he-IL",
                    "integration": "WEB_SDK",
                    "integrationVersion": "3.8.0",
                    "appId": "webAsync",
                    "ipAddress": "77.137.65.168",
                    "pendingAgentSurvey": True,
                    "latestHandlerAccountId": "40920689",
                    "latestHandlerSkillId": 3748060538,
                },
                "messageRecords": [
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "היי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:0",
                        "audience": "ALL",
                        "seq": 0,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:19.187+0000",
                        "timeL": 1714407019187,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "תודה שפנית לסה\"ר. נשמח להקשיב לכל מה שתבחר/י לשתף אותנו היום.\n\nלקריאת תקנון הצ'אט:\nhttps://sahar.org.il/sahars-chat-rules/"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:2",
                        "audience": "ALL",
                        "seq": 2,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:21.727+0000",
                        "timeL": 1714407021727,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"קראתי את התקנון ואני מסכימ\\\\ה","tooltip":"קראתי את התקנון ואני מסכימ\\\\ה"},{"type":"button","title":"מסכימ\\\\ה","tooltip":"מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"מסכימ\\\\ה"}]}},{"type":"button","title":"לא מסכימ\\\\ה","tooltip":"לא מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"לא מסכימ\\\\ה"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:4",
                        "audience": "ALL",
                        "seq": 4,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:23.741+0000",
                        "timeL": 1714407023741,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מסכימ\\ה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:8",
                        "audience": "ALL",
                        "seq": 8,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:25.199+0000",
                        "timeL": 1714407025199,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אנא רשמו שם או כינוי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:10",
                        "audience": "ALL",
                        "seq": 10,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:27.403+0000",
                        "timeL": 1714407027403,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"f7f124ad-8457-410c-b64c-9ec365627bf2","botInteractionId":"0e9f61dd1e14d6d43d93d3c689d9444fb5a3bdf5","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מאיה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:12",
                        "audience": "ALL",
                        "seq": 12,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:30.773+0000",
                        "timeL": 1714407030773,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:","tooltip":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:"},{"type":"button","title":"10-13","tooltip":"10-13","click":{"actions":[{"type":"publishText","text":"10-13"}]}},{"type":"button","title":"14-17","tooltip":"14-17","click":{"actions":[{"type":"publishText","text":"14-17"}]}},{"type":"button","title":"18-20","tooltip":"18-20","click":{"actions":[{"type":"publishText","text":"18-20"}]}},{"type":"button","title":"21-30","tooltip":"21-30","click":{"actions":[{"type":"publishText","text":"21-30"}]}},{"type":"button","title":"31-40","tooltip":"31-40","click":{"actions":[{"type":"publishText","text":"31-40"}]}},{"type":"button","title":"41-50","tooltip":"41-50","click":{"actions":[{"type":"publishText","text":"41-50"}]}},{"type":"button","title":"51-64","tooltip":"51-64","click":{"actions":[{"type":"publishText","text":"51-64"}]}},{"type":"button","title":"65+","tooltip":"65+","click":{"actions":[{"type":"publishText","text":"65+"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:14",
                        "audience": "ALL",
                        "seq": 14,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:33.029+0000",
                        "timeL": 1714407033029,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"cc46061d-f8ee-4ef0-a3bb-5f4d830a0f23","botInteractionId":"9979f9f953911d7a19f2a5ed1c751d7267a395a9","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "31-40"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:18",
                        "audience": "ALL",
                        "seq": 18,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:34.825+0000",
                        "timeL": 1714407034825,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": 'הנך מועבר\\ת לשוחח עם סה"ר'}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:20",
                        "audience": "ALL",
                        "seq": 20,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:35.215+0000",
                        "timeL": 1714407035215,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"ec90f86d-504e-49e5-9d14-86193a6710ef","botInteractionId":"2c88d0bb-c687-47c9-9bb5-ca8f79dd97b7","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Exact_Value","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "שלום כאן איתך לשיחה עד 40 דקות מקשיבה למה שתרצי לשתף..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:23",
                        "audience": "ALL",
                        "seq": 23,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:23.585+0000",
                        "timeL": 1714407083585,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "היי.. יש אפשרות לדבר עם מתנדב?"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:25",
                        "audience": "ALL",
                        "seq": 25,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:51.578+0000",
                        "timeL": 1714407111578,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "היי , אין לנו כרגע מתנדב את יכולה לנסות לעלות מאוחר יותר .."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:29",
                        "audience": "ALL",
                        "seq": 29,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:13:24.582+0000",
                        "timeL": 1714407204582,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אוקי. אני מבקשת לדבר עם מתנדב כי אני מכירה אחת מכן וחוששת שהיא זו שתענה לי."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:31",
                        "audience": "ALL",
                        "seq": 31,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:16.753+0000",
                        "timeL": 1714407256753,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "אבל כרגע המצב לא טוב ואני קצת חוששת מעצמי"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:35",
                        "audience": "ALL",
                        "seq": 35,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:56.608+0000",
                        "timeL": 1714407296608,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אני מבינה יקרה ... תרצי לחזור למשמרת הבאה ב21 או לשתף אותי במה שאת מרגישה ..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:38",
                        "audience": "ALL",
                        "seq": 38,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:15:25.096+0000",
                        "timeL": 1714407325096,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אני לא מצליחה לחשוב"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:40",
                        "audience": "ALL",
                        "seq": 40,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:18:14.266+0000",
                        "timeL": 1714407494266,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "שומעת שאת מרגישה מבולבלת ..."}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:44",
                        "audience": "ALL",
                        "seq": 44,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:20:47.088+0000",
                        "timeL": 1714407647088,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "לא משנה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:46",
                        "audience": "ALL",
                        "seq": 46,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:06.761+0000",
                        "timeL": 1714407666761,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "תודה לך"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:48",
                        "audience": "ALL",
                        "seq": 48,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:09.244+0000",
                        "timeL": 1714407669244,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "יקרה מצטערת שאין מענה מתאים כרגע מוזמנת לחזור ב21 ולבקש מתנדב ..❤️"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:53",
                        "audience": "ALL",
                        "seq": 53,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:41.580+0000",
                        "timeL": 1714407701580,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אוקי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:55",
                        "audience": "ALL",
                        "seq": 55,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:49.209+0000",
                        "timeL": 1714407709209,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                ],
            },
            {
                "info": {
                    "startTime": "2024-04-29 16:10:18.818+0000",
                    "startTimeL": 1714407018818,
                    "endTime": "2024-04-29 16:21:52.261+0000",
                    "endTimeL": 1714407712261,
                    "conversationEndTime": "2024-04-29 16:21:52.261+0000",
                    "conversationEndTimeL": 1714407712261,
                    "fullDialogEndTime": "2024-04-29 16:21:52.261+0000",
                    "fullDialogEndTimeL": 1714407712261,
                    "duration": 693443,
                    "conversationId": "47b21186-4501-4363-8752-111111111111",
                    "brandId": "40920689",
                    "latestAgentId": "3998511138",
                    "latestAgentNickname": 'מתנדבת סה"ר',
                    "latestAgentFullName": "טל הלן פרנץ",
                    "latestAgentLoginName": "talfrantz123",
                    "agentDeleted": False,
                    "latestSkillId": 3748060538,
                    "latestSkillName": "Web-Messaging-Hebrew",
                    "source": "SHARK",
                    "closeReason": "CONSUMER",
                    "closeReasonDescription": "MANUAL_CLOSE",
                    "status": "CLOSE",
                    "fullDialogStatus": "CLOSE",
                    "firstConversation": False,
                    "device": "DESKTOP",
                    "browser": "CHROME",
                    "browserVersion": "123.0.0.0",
                    "operatingSystem": "WINDOWS",
                    "operatingSystemVersion": "10.0",
                    "latestAgentGroupId": -1,
                    "latestAgentGroupName": "Main Group",
                    "latestQueueState": "ACTIVE",
                    "isPartial": False,
                    "visitorId": "A4NTBiZjNmNmNkZDQxZTgz",
                    "sessionId": "19IjNQcVQVeQrIZx_ExdTw",
                    "interactionContextId": "3",
                    "timeZone": 'sun.util.calendar.ZoneInfo[id="Asia/Jerusalem",offset=7200000,dstSavings=3600000,useDaylight=true,transitions=149,lastRule=java.util.SimpleTimeZone[id=Asia/Jerusalem,offset=7200000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=23,startDayOfWeek=6,startTime=7200000,startTimeMode=0,endMode=2,endMonth=9,endDay=-1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]]',
                    "features": [
                        "PHOTO_SHARING",
                        "CO_BROWSE",
                        "QUICK_REPLIES",
                        "MARKDOWN_HYPERLINKS",
                        "AUTO_MESSAGES",
                        "MULTI_DIALOG",
                        "FILE_SHARING",
                        "RICH_CONTENT",
                    ],
                    "language": "he-IL",
                    "integration": "WEB_SDK",
                    "integrationVersion": "3.8.0",
                    "appId": "webAsync",
                    "ipAddress": "77.137.65.168",
                    "pendingAgentSurvey": True,
                    "latestHandlerAccountId": "40920689",
                    "latestHandlerSkillId": 3748060538,
                },
                "messageRecords": [
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "היי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:0",
                        "audience": "ALL",
                        "seq": 0,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:19.187+0000",
                        "timeL": 1714407019187,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "תודה שפנית לסה\"ר. נשמח להקשיב לכל מה שתבחר/י לשתף אותנו היום.\n\nלקריאת תקנון הצ'אט:\nhttps://sahar.org.il/sahars-chat-rules/"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:2",
                        "audience": "ALL",
                        "seq": 2,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:21.727+0000",
                        "timeL": 1714407021727,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"קראתי את התקנון ואני מסכימ\\\\ה","tooltip":"קראתי את התקנון ואני מסכימ\\\\ה"},{"type":"button","title":"מסכימ\\\\ה","tooltip":"מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"מסכימ\\\\ה"}]}},{"type":"button","title":"לא מסכימ\\\\ה","tooltip":"לא מסכימ\\\\ה","click":{"actions":[{"type":"publishText","text":"לא מסכימ\\\\ה"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:4",
                        "audience": "ALL",
                        "seq": 4,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:23.741+0000",
                        "timeL": 1714407023741,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"8519089a-91dc-45d1-8ddd-698e67cc6f62","botInteractionId":"d1f778ec-4a9a-412f-96b8-c22499bc3be4","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Pattern","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מסכימ\\ה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:8",
                        "audience": "ALL",
                        "seq": 8,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:25.199+0000",
                        "timeL": 1714407025199,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אנא רשמו שם או כינוי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:10",
                        "audience": "ALL",
                        "seq": 10,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:27.403+0000",
                        "timeL": 1714407027403,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"f7f124ad-8457-410c-b64c-9ec365627bf2","botInteractionId":"0e9f61dd1e14d6d43d93d3c689d9444fb5a3bdf5","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "מאיה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:12",
                        "audience": "ALL",
                        "seq": 12,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:30.773+0000",
                        "timeL": 1714407030773,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "RICH_CONTENT",
                        "messageData": {
                            "richContent": {
                                "content": '{"type":"vertical","tag":"button","elements":[{"type":"text","text":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:","tooltip":"אנו רוצים להעניק לך מענה מותאם. אנא סמן/י את גילך:"},{"type":"button","title":"10-13","tooltip":"10-13","click":{"actions":[{"type":"publishText","text":"10-13"}]}},{"type":"button","title":"14-17","tooltip":"14-17","click":{"actions":[{"type":"publishText","text":"14-17"}]}},{"type":"button","title":"18-20","tooltip":"18-20","click":{"actions":[{"type":"publishText","text":"18-20"}]}},{"type":"button","title":"21-30","tooltip":"21-30","click":{"actions":[{"type":"publishText","text":"21-30"}]}},{"type":"button","title":"31-40","tooltip":"31-40","click":{"actions":[{"type":"publishText","text":"31-40"}]}},{"type":"button","title":"41-50","tooltip":"41-50","click":{"actions":[{"type":"publishText","text":"41-50"}]}},{"type":"button","title":"51-64","tooltip":"51-64","click":{"actions":[{"type":"publishText","text":"51-64"}]}},{"type":"button","title":"65+","tooltip":"65+","click":{"actions":[{"type":"publishText","text":"65+"}]}}]}'
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:14",
                        "audience": "ALL",
                        "seq": 14,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:33.029+0000",
                        "timeL": 1714407033029,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"cc46061d-f8ee-4ef0-a3bb-5f4d830a0f23","botInteractionId":"9979f9f953911d7a19f2a5ed1c751d7267a395a9","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "31-40"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:18",
                        "audience": "ALL",
                        "seq": 18,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:34.825+0000",
                        "timeL": 1714407034825,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": 'הנך מועבר\\ת לשוחח עם סה"ר'}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:20",
                        "audience": "ALL",
                        "seq": 20,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3740746438",
                        "source": "SHARK",
                        "time": "2024-04-29 16:10:35.215+0000",
                        "timeL": 1714407035215,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {
                            "rawMetadata": '[{"type":"CbBotResponseMetaData","botMsgId":"ec90f86d-504e-49e5-9d14-86193a6710ef","botInteractionId":"2c88d0bb-c687-47c9-9bb5-ca8f79dd97b7","botInteractionName":"","botId":"20396d8d-369c-42f5-b7a9-a63f8714c23c","botType":"CUSTOMER_FACING_BOT","botProvider":"LP CB","botProviderType":"1P_LP_CONNECTOR","intentId":"","intentName":"","matchType":"Exact_Value","domainName":"","domainType":""}]',
                            "structuredMetadata": [],
                        },
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "שלום כאן איתך לשיחה עד 40 דקות מקשיבה למה שתרצי לשתף..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:23",
                        "audience": "ALL",
                        "seq": 23,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:23.585+0000",
                        "timeL": 1714407083585,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "היי.. יש אפשרות לדבר עם מתנדב?"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:25",
                        "audience": "ALL",
                        "seq": 25,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:11:51.578+0000",
                        "timeL": 1714407111578,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "היי , אין לנו כרגע מתנדב את יכולה לנסות לעלות מאוחר יותר .."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:29",
                        "audience": "ALL",
                        "seq": 29,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:13:24.582+0000",
                        "timeL": 1714407204582,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אוקי. אני מבקשת לדבר עם מתנדב כי אני מכירה אחת מכן וחוששת שהיא זו שתענה לי."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:31",
                        "audience": "ALL",
                        "seq": 31,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:16.753+0000",
                        "timeL": 1714407256753,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "אבל כרגע המצב לא טוב ואני קצת חוששת מעצמי"}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:35",
                        "audience": "ALL",
                        "seq": 35,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:14:56.608+0000",
                        "timeL": 1714407296608,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "אני מבינה יקרה ... תרצי לחזור למשמרת הבאה ב21 או לשתף אותי במה שאת מרגישה ..."
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:38",
                        "audience": "ALL",
                        "seq": 38,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:15:25.096+0000",
                        "timeL": 1714407325096,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אני לא מצליחה לחשוב"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:40",
                        "audience": "ALL",
                        "seq": 40,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:18:14.266+0000",
                        "timeL": 1714407494266,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {"text": "שומעת שאת מרגישה מבולבלת ..."}
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:44",
                        "audience": "ALL",
                        "seq": 44,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:20:47.088+0000",
                        "timeL": 1714407647088,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "לא משנה"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:46",
                        "audience": "ALL",
                        "seq": 46,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:06.761+0000",
                        "timeL": 1714407666761,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "תודה לך"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:48",
                        "audience": "ALL",
                        "seq": 48,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:09.244+0000",
                        "timeL": 1714407669244,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {
                            "msg": {
                                "text": "יקרה מצטערת שאין מענה מתאים כרגע מוזמנת לחזור ב21 ולבקש מתנדב ..❤️"
                            }
                        },
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:53",
                        "audience": "ALL",
                        "seq": 53,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "3998511138",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:41.580+0000",
                        "timeL": 1714407701580,
                        "integrationSource": "SHARK",
                        "sentBy": "Agent",
                        "contextData": {"rawMetadata": "[]", "structuredMetadata": []},
                        "predefinedContent": False,
                    },
                    {
                        "type": "TEXT_PLAIN",
                        "messageData": {"msg": {"text": "אוקי"}},
                        "messageId": "ms::dialog:47b21186-4501-4363-8752-27bc8bd212b7::msg:55",
                        "audience": "ALL",
                        "seq": 55,
                        "dialogId": "47b21186-4501-4363-8752-27bc8bd212b7",
                        "participantId": "afae94dfe29ab73ff32e45d760068b6b1bb368ecb7fe3f039d59d6cf30bd3bc9",
                        "source": "SHARK",
                        "time": "2024-04-29 16:21:49.209+0000",
                        "timeL": 1714407709209,
                        "integrationSource": "SHARK",
                        "device": "DESKTOP",
                        "sentBy": "Consumer",
                    },
                ],
            },
        ],
    }

    @patch("ConversationCache.ConfigUtil", MockConfigUtilWithDifferentValues)
    def setUp(self):
        self.cache = ConversationCache()

    def tearDown(self):
        self.cache = None

    def test_update_open_conversations(self):
        self.cache.update_conversations(
            datetime.now(),
            LpUtils.extract_conversations(self.conversation_data),
            LpUtils.extract_messages(self.conversation_data),
        )
        # Call the method to be tested
        self.cache.update_conversations(
            currentTime, conversation_data, messages_data
        )
        # Assert that the open conversations and messages have been updated correctly
        self.assertEqual(len(self.cache.open_conversations), 2)
        self.assertEqual(len(self.cache.messages), 2)

    def test_cleanup_old_data(self):
        # Mock the cleanup thread
        self.cache.cleanup_thread = MagicMock()
        # Mock the current time
        currentTime = MagicMock()
        # Mock the closed conversations and messages
        self.cache.closed_conversations = {
            "conv_id_1": MagicMock(),
            "conv_id_2": MagicMock(),
        }
        self.cache.messages = {"conv_id_1": MagicMock(), "conv_id_2": MagicMock()}
        # Call the method to be tested
        self.cache.cleanup_old_data()
        # Assert that the closed conversations and messages have been cleaned up
        self.assertEqual(len(self.cache.closed_conversations), 0)
        self.assertEqual(len(self.cache.messages), 0)
